# Εφαρμογή Ανάλυσης Δεδομένων scRNA-seq με Streamlit

## 1. Περιγραφή Project

Αυτή η εφαρμογή Streamlit έχει αναπτυχθεί για την tương tácτική ανάλυση δεδομένων single-cell RNA sequencing (scRNA-seq). Επιτρέπει στους χρήστες να ανεβάζουν τα δεδομένα τους σε μορφή AnnData (.h5ad) και να εκτελούν ένα ολοκληρωμένο pipeline ανάλυσης, το οποίο περιλαμβάνει βήματα όπως ποιοτικός έλεγχος (QC), ενοποίηση πολλαπλών δειγμάτων (με Scanorama), μείωση διαστατικότητας (PCA, UMAP), ομαδοποίηση κυττάρων (Leiden clustering), ανάλυση διαφορικά εκφρασμένων γονιδίων (DEG), και χαρακτηρισμό κυτταρικών τύπων (με Decoupler). Η εφαρμογή παρέχει παραμετροποίηση για τα περισσότερα βήματα και οπτικοποιεί τα αποτελέσματα με διαδραστικό τρόπο.

Το project αυτό αναπτύχθηκε στο πλαίσιο εργασίας και περιλαμβάνει Dockerization για εύκολη ανάπτυξη και αναπαραγωγιμότητα, καθώς και ένα συνοδευτικό LaTeX report που περιγράφει λεπτομερώς την υλοποίηση.

## 2. Χαρακτηριστικά

*   Φόρτωση ενός ή πολλαπλών αρχείων AnnData (`.h5ad`).
*   Προεπισκόπηση των φορτωμένων δεδομένων.
*   **Ενοποίηση Δεδομένων:** Διόρθωση batch effects με Scanorama (προαιρετικό, για >1 δείγματα).
*   **Ποιοτικός Έλεγχos (QC):** Δυνατότητα ορισμού παραμέτρων για φιλτράρισμα κυττάρων και γονιδίων (min counts/genes, max genes, mitochondrial percentage). Οπτικοποίηση QC metrics (violin plots) πριν και μετά.
*   **Ομαλοποίηση και Εντοπισμός HVGs:** Normalization των δεδομένων και επιλογή Highly Variable Genes.
*   **Μείωση Διαστατικότητας & Clustering:** Εκτέλεση PCA, υπολογισμός UMAP embedding, και ομαδοποίηση με τον αλγόριθμο Leiden. Δυνατότητα παραμετροποίησης (αριθμός PCs, neighbors, UMAP min_dist, Leiden resolution).
*   **Οπτικοποίηση UMAP:** Διαδραστικά UMAP plots χρωματισμένα βάσει Leiden clusters, batch, ή άλλων `.obs` μεταβλητών. Δυνατότητα οπτικοποίησης της έκφρασης συγκεκριμένων γονιδίων στο UMAP.
*   **Ανάλυση Διαφορικά Εκφρασμένων Γονιδίων (DEG):** Εντοπισμός DEGs μεταξύ επιλεγμένων ομάδων (π.χ., clusters, συνθήκες). Δυνατότητα επιλογής μεθόδου (Wilcoxon, t-test, logreg). Εμφάνιση των top DEGs σε πίνακα και Volcano Plot.
*   **Χαρακτηρισμός Κυτταρικών Τύπων:** Με χρήση της βιβλιοθήκης Decoupler (μέθοδοι ORA και WMS) βάσει αρχείου δεικτών που παρέχει ο χρήστης. Οπτικοποίηση των ORA scores (heatmap) και WMS scores (violin plots).
*   **Διαχείριση Κατάστασης:** Η πρόοδος της ανάλυσης διατηρείται κατά την αλληλεπίδραση με την εφαρμογή.
*   **Dockerized:** Παρέχεται `Dockerfile` για εύκολη δημιουργία container και εκτέλεση της εφαρμογής σε οποιοδήποτε σύστημα με Docker.
*   **Καρτέλα Πληροφοριών Ομάδας:** Εμφανίζει πληροφορίες για το project και τους δημιουργούς.
*   **Οργανωμένο UI:** Χρήση tabs και expanders στο sidebar για καλύτερη οργάνωση των επιλογών.

## 3. Τεχνολογίες που Χρησιμοποιήθηκαν

*   **Python 3.12**
*   **Streamlit:** Για τη δημιουργία της διαδραστικής web εφαρμογής.
*   **Scanpy:** Κύρια βιβλιοθήκη για την ανάλυση scRNA-seq δεδομένων.
*   **AnnData:** Για τη δομή και διαχείριση των δεδομένων.
*   **Pandas & Numpy:** Για χειρισμό δεδομένων.
*   **Matplotlib & Seaborn:** Για τη δημιουργία στατικών οπτικοποιήσεων (που ενσωματώνονται στο Streamlit).
*   **Decoupler:** Για τον χαρακτηρισμό κυτταρικών τύπων.
*   **Scanorama:** Για την ενοποίηση δεδομένων και αφαίρεση batch effects.
*   **hdf5plugin:** Για την υποστήριξη αρχείων HDF5 (που χρησιμοποιούνται από τα .h5ad).
*   **adjustText:** Για τη βελτίωση της εμφάνισης κειμένου σε plots.
*   **scikit-misc:** Βοηθητικές συναρτήσεις για επιστημονικούς υπολογισμούς.
*   **igraph & leidenalg:** Για την εκτέλεση του Leiden clustering.
*   **Docker:** Για τη δημιουργία container της εφαρμογής.
*   **LaTeX:** Για τη συγγραφή της τελικής αναφοράς.

## 4. Δομή Project

```
TL_Project/
├── .dockerignore           # Αρχεία που αγνοούνται από το Docker κατά το build
├── .venv/                  # Εικονικό περιβάλλον Python (αγνοείται από το git & Docker)
├── data/
│   ├── RAW/                # Ακατέργαστα δεδομένα (π.χ., από GEO, σε φακέλους ανά δείγμα)
│   ├── h5ad/               # Αρχεία .h5ad που δημιουργήθηκαν από τα RAW δεδομένα
│   └── h5ad_filt/          # Φιλτραρισμένα αρχεία .h5ad μετά την αρχική προεπεξεργασία
├── pipeline_scripts/       # Python scripts με τις συναρτήσεις του pipeline
│   ├── __init__.py
│   ├── annotation.py
│   ├── deg_analysis.py
│   ├── dimensionality_reduction.py
│   ├── integration.py
│   └── preprocessing.py
├── app.py                  # Το κύριο αρχείο της εφαρμογής Streamlit
├── Dockerfile              # Οδηγίες για το χτίσιμο της Docker image
├── generate_h5ad_files.py  # Script για μετατροπή RAW σε .h5ad (αν χρειάζεται εκ νέου)
├── progress_report.md      # Αναφορά προόδου του project
├── project_plan.md         # Αρχικό πλάνο του project
├── README.md               # Αυτό το αρχείο
├── report.tex              # Το LaTeX αρχείο της τελικής αναφοράς
└── requirements.txt        # Λίστα με τις εξαρτήσεις Python
```

## 5. Οδηγίες Εγκατάστασης και Εκτέλεσης

### 5.1. Μέσω Docker (Συνιστώμενη Μέθοδος)

Αυτή είναι η προτεινόμενη μέθοδος για την εκτέλεση της εφαρμογής, καθώς διασφαλίζει ότι όλες οι εξαρτήσεις είναι σωστά εγκατεστημένες και η εφαρμογή εκτελείται σε ένα ελεγχόμενο περιβάλλον.

**Προαπαιτούμενα:**
*   Εγκατεστημένο [Docker Desktop](https://www.docker.com/products/docker-desktop/) (ή Docker Engine σε Linux).

**Βήματα:**

1.  **Klonopoíisi tou Repository (αν δεν το έχετε ήδη):**
    ```bash
    git clone <URL_του_repository_σας>
    cd TL_Project
    ```

2.  **Τοποθέτηση Δεδομένων:**
    Βεβαιωθείτε ότι τα φιλτραρισμένα αρχεία σας `.h5ad` βρίσκονται στον κατάλογο `data/h5ad_filt/` του project. Για παράδειγμα:
    ```
    TL_Project/
    └── data/
        └── h5ad_filt/
            ├── filtered_sample1.h5ad
            └── filtered_sample2.h5ad
    ```
    Αν τα δεδομένα σας είναι σε άλλη θέση, θα χρειαστεί να προσαρμόσετε την εντολή `docker run` στο βήμα 4.

3.  **Build της Docker Image:**
    Από τον κύριο κατάλογο του project (`TL_Project`), εκτελέστε την παρακάτω εντολή για να χτίσετε την Docker image. Αυτό μπορεί να διαρκέσει μερικά λεπτά, ειδικά την πρώτη φορά.
    ```bash
    docker build -t streamlit-scrna-app .
    ```

4.  **Εκτέλεση του Docker Container:**
    Μετά το επιτυχές build, εκτελέστε την παρακάτω εντολή για να ξεκινήσετε την εφαρμογή:

    *   Για Windows (PowerShell):
        ```powershell
        docker run -p 8501:8501 -v ${PWD}/data/h5ad_filt:/app/data/h5ad_filt streamlit-scrna-app
        ```
    *   Για Linux/macOS:
        ```bash
        docker run -p 8501:8501 -v $(pwd)/data/h5ad_filt:/app/data/h5ad_filt streamlit-scrna-app
        ```
    *Επεξήγηση της εντολής `docker run`:
        *   `-p 8501:8501`: Αντιστοιχίζει την πόρτα 8501 του υπολογιστή σας στην πόρτα 8501 του container όπου εκτελείται το Streamlit.
        *   `-v ${PWD}/data/h5ad_filt:/app/data/h5ad_filt`: Κάνει "mount" τον τοπικό σας κατάλογο `data/h5ad_filt` (που περιέχει τα δεδομένα σας) στον κατάλογο `/app/data/h5ad_filt` μέσα στο container. Η εφαρμογή περιμένει να βρει τα αρχεία `.h5ad` σε αυτή τη διαδρομή μέσα στο container.*

5.  **Πρόσβαση στην Εφαρμογή:**
    Ανοίξτε έναν web browser και πλοηγηθείτε στη διεύθυνση: `http://localhost:8501`

### 5.2. Τοπική Εκτέλεση (Για Ανάπτυξη/Development)

Αυτή η μέθοδος είναι κατάλληλη αν θέλετε να κάνετε αλλαγές στον κώδικα.

**Προαπαιτούμενα:**
*   Python 3.10+ (συνιστάται Python 3.12, όπως χρησιμοποιήθηκε στην ανάπτυξη).
*   Για χρήστες Windows, συνιστάται η χρήση του Windows Subsystem for Linux (WSL) για την ευκολότερη διαχείριση των επιστημονικών πακέτων Python.
*   `pip` και `venv`.

**Βήματα:**

1.  **Klonopoíisi tou Repository (αν δεν το έχετε ήδη):**
    ```bash
    git clone <URL_του_repository_σας>
    cd TL_Project
    ```

2.  **Δημιουργία και Ενεργοποίηση Εικονικού Περιβάλλοντος:**
    ```bash
    python -m venv .venv
    # Για Windows (PowerShell)
    # .\.venv\Scripts\Activate.ps1
    # Για Windows (cmd.exe)
    # .venv\Scripts\activate.bat
    # Για Linux/macOS
    source .venv/bin/activate
    ```

3.  **Εγκατάσταση Εξαρτήσεων:**
    ```bash
    pip install -r requirements.txt
    ```
    *Σημείωση: Αν αντιμετωπίσετε προβλήματα με την εγκατάσταση πακέτων όπως `igraph`, `leidenalg`, ή `annoy`, ειδικά σε Windows χωρίς WSL, μπορεί να χρειαστεί να εγκαταστήσετε επιπλέον C/C++ compilers ή να βρείτε προ-μεταγλωττισμένα wheels για το σύστημά σας.*

4.  **Τοποθέτηση Δεδομένων:**
    Βεβαιωθείτε ότι τα φιλτραρισμένα αρχεία σας `.h5ad` βρίσκονται στον κατάλογο `data/h5ad_filt/` του project.

5.  **Εκτέλεση της Εφαρμοής Streamlit:**
    ```bash
    streamlit run app.py
    ```

6.  **Πρόσβαση στην Εφαρμογή:**
    Το Streamlit θα ανοίξει αυτόματα την εφαρμογή στον προεπιλεγμένο σας browser, ή θα σας δώσει μια τοπική διεύθυνση URL (συνήθως `http://localhost:8501`).

## 6. Οδηγίες Χρήσης της Εφαρμογής

1.  **Φόρτωση Δεδομένων:**
    *   Στην καρτέλα "🔬 Ανάλυση Δεδομένων", χρησιμοποιήστε το widget "Ανεβάστε ένα ή περισσότερα αρχεία AnnData (.h5ad)" για να επιλέξετε τα αρχεία σας από τον κατάλογο `data/h5ad_filt/` (ή από όπου τα έχετε αποθηκεύσει, αν εκτελείτε τοπικά).
    *   Πατήστε το κουμπί "Επεξεργασία & Φόρτωση Επιλεγμένων Αρχείων".
    *   Μια προεπισκόπηση των δεδομένων θα εμφανιστεί (πληροφορίες AnnData, `.obs.head()`, `.var.head()`).

2.  **Ενοποίηση (Scanorama) (Προαιρετικό):**
    *   Στο sidebar, στην ενότητα "1.5 Ενοποίηση (Scanorama)", αν έχετε ανεβάσει πολλαπλά αρχεία, μπορείτε να ενεργοποιήσετε το Scanorama.
    *   Ορίστε τον αριθμό διαστάσεων και πατήστε "Εφαρμογή Scanorama".

3.  **Προεπεξεργασία (QC):**
    *   Στο sidebar, στην ενότητα "2. Προεπεξεργασία (QC)", ενεργοποιήστε την προεπεξεργασία.
    *   Ορίστε τις παραμέτρους QC (Min counts/gene, Min/Max genes/cell, Max % mito, Target sum, HVGs).
    *   Πατήστε "Εκτέλεση Προεπεξεργασίας".
    *   Θα εμφανιστούν violin plots με τα QC metrics πριν και μετά το φιλτράρισμα.

4.  **PCA, UMAP & Clustering:**
    *   Στο sidebar, στην ενότητα "3. PCA, UMAP & Clustering", ενεργοποιήστε το βήμα.
    *   Ορίστε παραμέτρους (Αριθμός PCs, Γειτόνων, UMAP Min Distance, Leiden Resolution, Χρήση HVGs).
    *   Πατήστε "Εκτέλεση PCA, UMAP & Clustering".
    *   Θα εμφανιστεί ένα UMAP plot. Μπορείτε να επιλέξετε τη μεταβλητή χρωματισμού από το selectbox (π.χ., `leiden` clusters) ή να εισάγετε ονόματα γονιδίων στο πεδίο κειμένου για να δείτε την έκφρασή τους.

5.  **Ανάλυση DEG:**
    *   Στο sidebar, στην ενότητα "4. Ανάλυση DEG", ενεργοποιήστε την ανάλυση.
    *   Επιλέξτε τη στήλη ομαδοποίησης (π.χ., `leiden`), την ομάδα/ες ενδιαφέροντος και την ομάδα αναφοράς.
    *   Ορίστε τη μέθοδο DEG, τον αριθμό γονιδίων για εμφάνιση, και τα κατώφλια για το Volcano Plot.
    *   Πατήστε "Εκτέλεση Ανάλυσης DEG".
    *   Θα εμφανιστεί ένας πίνακας με τα top DEGs και ένα Volcano Plot.

6.  **Χαρακτηρισμός Κυτταρικών Τύπων (Decoupler):**
    *   Στο sidebar, στην ενότητα "5. Χαρ/σμός Κυτ. Τύπων (Decoupler)", ενεργοποιήστε την ανάλυση.
    *   Ανεβάστε ένα αρχείο δεικτών `.csv`.
    *   Πατήστε "Επεξεργασία Αρχείου Δεικτών".
    *   Επιλέξτε τις στήλες για τον τύπο κυττάρου και το σύμβολο γονιδίου και πατήστε "Δημιουργία Λεξικού Δεικτών".
    *   Ορίστε παραμέτρους (min_n) και επιλέξτε αν θα εκτελεστεί ORA ή/και WMS.
    *   Πατήστε "Εκτέλεση Ανάλυσης Decoupler".
    *   Θα εμφανιστούν ORA Scores Heatmap και WMS Scores Violin Plots. Οι WMS scores θα είναι επίσης διαθέσιμοι για χρωματισμό του UMAP.

## 7. Πληροφορίες Ομάδας

*   **Όνομα Project:** Ανάπτυξη Διαδραστικής Εφαρμογής scRNA-seq
*   **Μέλη Ομάδας:**
    *   Στεργιούλας Γεώργιος (inf2021216)
    *   Αναγνωστόπουλος Φίλιππος (inf2021014)
*   **Ημερομηνία:** Μάιος 2025

## 8. Πιθανές Μελλοντικές Βελτιώσεις

*   Υποστήριξη για περισσότερες μεθόδους ενοποίησης δεδομένων.
*   Προσθήκη πιο προχωρημένων μεθόδων μείωσης διαστατικότητας και clustering.
*   Ενσωμάτωση ανάλυσης τροχιών (trajectory analysis).
*   Πιο ευέλικτες επιλογές οπτικοποίησης και εξαγωγής διαγραμμάτων σε υψηλή ανάλυση.
*   Βελτιωμένη διαχείριση σφαλμάτων και πιο λεπτομερή μηνύματα προς τον χρήστη.
*   Δυνατότητα αποθήκευσης και φόρτωσης της κατάστασης της ανάλυσης.
*   Διασύνδεση με βάσεις δεδομένων γονιδιωματικών σχολιασμών (gene annotations). 